<Window x:Class="Prüfstand_Bedienanwendung_V3.Views.Dialogs.MetricSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:data="clr-namespace:Prüfstand_Bedienanwendung_V3.Data"
        Title="Kachel-Einstellungen"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        Background="#1E1E1E"
        Foreground="#EAEAEA"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Badge-Stil für Kategorie -->
        <Style x:Key="Badge" TargetType="Border">
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="#303030"/>
            <Setter Property="BorderBrush" Value="#484848"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <!-- ItemTemplate für Messwerte -->
        <DataTemplate x:Key="MetricItemTemplate" DataType="{x:Type data:MetricDefinition}">
            <Grid Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Marker -->
                <Ellipse Width="8" Height="8" VerticalAlignment="Center" Fill="#6AA84F"/>

                <StackPanel Grid.Column="2" Orientation="Vertical" Margin="0,-2,0,0">
                    <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13" />
                    <StackPanel Orientation="Horizontal" Margin="0,1,0,0">
                        <TextBlock Text="{Binding Unit}" Opacity="0.9"/>
                        <TextBlock Text="  •  " Opacity="0.5"/>
                        <TextBlock Opacity="0.9">
                            <Run Text="Standard:"/>
                            <Run Text="{Binding DefaultMin, StringFormat={}{0:G}}"/>
                            <Run Text=" – "/>
                            <Run Text="{Binding DefaultMax, StringFormat={}{0:G}}"/>
                        </TextBlock>
                        <Border Style="{StaticResource Badge}" Margin="8,0,0,0">
                            <TextBlock Text="{Binding Category}" FontSize="11" Opacity="0.9" />
                        </Border>
                    </StackPanel>
                    <TextBlock Text="{Binding Key}" FontSize="10" Opacity="0.6"/>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <!-- Lesbare Dropdown-Items (Dark) -->
        <Style x:Key="DarkComboItem" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2B2B2B"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#2E7D32"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Padding="18" Background="#2A2A2A" CornerRadius="12">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Messwert -->
                <RowDefinition Height="Auto"/>
                <!-- Min -->
                <RowDefinition Height="Auto"/>
                <!-- Max -->
                <RowDefinition Height="Auto"/>
                <!-- Hinweis -->
                <RowDefinition Height="Auto"/>
                <!-- Buttons -->
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="360"/>
            </Grid.ColumnDefinitions>

            <!-- Messwert -->
            <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,0,12,8"
                       VerticalAlignment="Center" Text="Messwert" />
            <ComboBox Grid.Row="0" Grid.Column="1" Margin="0,0,0,12" Height="38"
                      ItemsSource="{Binding Metrics}"
                      ItemTemplate="{StaticResource MetricItemTemplate}"
                      ItemContainerStyle="{StaticResource DarkComboItem}"
                      SelectedValuePath="Key"
                      SelectedValue="{Binding SelectedMetricKey, UpdateSourceTrigger=PropertyChanged}"
                      Background="#1E1E1E" Foreground="White"
                      BorderBrush="#3A3A3A" BorderThickness="1">
                <!-- Erzwinge dunkle Systemfarben im Popup -->
                <ComboBox.Resources>
                    <SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}" Color="#1E1E1E"/>
                    <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#1E1E1E"/>
                    <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}" Color="#FFFFFF"/>
                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#2E7D32"/>
                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFFFFF"/>
                </ComboBox.Resources>
            </ComboBox>

            <!-- Min -->
            <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,0,12,8"
                       VerticalAlignment="Center" Text="Min" />
            <TextBox Grid.Row="1" Grid.Column="1" Height="36"
                     Text="{Binding MinText, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,0,0,12" Padding="8"
                     Background="#1E1E1E" Foreground="White"
                     BorderBrush="#3A3A3A" BorderThickness="1"/>

            <!-- Max -->
            <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,0,12,8"
                       VerticalAlignment="Center" Text="Max" />
            <TextBox Grid.Row="2" Grid.Column="1" Height="36"
                     Text="{Binding MaxText, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,0,0,12" Padding="8"
                     Background="#1E1E1E" Foreground="White"
                     BorderBrush="#3A3A3A" BorderThickness="1"/>

            <!-- Hinweis (gut lesbar) -->
            <Border Grid.Row="3" Grid.ColumnSpan="2"
                    Background="#333A40" CornerRadius="8"
                    Padding="10" Margin="0,0,0,12"
                    BorderBrush="#455A64" BorderThickness="1">
                <TextBlock FontSize="12" Foreground="White">
                    <Run Text="Tipp:" FontWeight="SemiBold"/>
                    <Run Text=" Beim Wechsel des Messwerts kannst du die Standard-Min/Max-Werte übernehmen oder eigene Grenzen lassen."/>
                </TextBlock>
            </Border>

            <!-- Buttons -->
            <StackPanel Grid.Row="4" Grid.ColumnSpan="2"
                        Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Width="96" Height="36" Margin="0,0,8,0"
                        Content="Abbrechen" IsCancel="True"
                        Background="#3A3A3A" Foreground="White"
                        BorderThickness="0"/>
                <Button Width="120" Height="36"
                        Content="Speichern" IsDefault="True"
                        Click="OnSaveClick"
                        Background="#2E7D32" Foreground="White"
                        BorderThickness="0"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
